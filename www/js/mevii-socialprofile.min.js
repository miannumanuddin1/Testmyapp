function InitializeSocialProfile(){

	var pictureSource;   // picture source
	var destinationType; // sets the format of returned value


	document.addEventListener("deviceready",onDeviceReady,false);

	function onDeviceReady(){
		pictureSource = navigator.camera.PictureSourceType;
		destinationType = navigator.camera.DestinationType;
	}
	$('#pictureUpload').on('click', function(){
		getPhoto(pictureSource.PHOTOLIBRARY);
	});
	$('#takePicture').on('click', function(){
		capturePhotoWithData();
	});

	$('#deletePicture').on('click', function () {
	    ShowConfirm("<strong>Are you sure you want to delete profile photo?</strong>", DeleteConfirm, ActionCancel);
	 
	});

	
	$('#socialAvailable,#stagesKids,#stagesSingle,#stagesEmpty,#timeZone,#dateOfBirth,#aboutMeText,#screenName,#employmentStatus').on('focus', function () {
	    $('#settingsOverlay-close').off();
	    $('#settingsOverlay-close').on('click', function () {
	        ShowConfirm("<strong>All unsaved changes will be lost. Do you want to proceed?</strong>", HidePage, ActionCancel);
	    });
	});

	$('#btnSocialProfileCancel').on('click', function () {
	    HideSocialProfile();
	    ResetOverlayEvent();
	});
	$('#btnSocialProfileSave').on('click', function () {
	    SaveSocialProfile();
		 ResetOverlayEvent();
	});
}
var _dataForImage = '';


function HidePage() {
    HideSettingsMenu();
    HideSettingsProfile();
    HideSocialProfile();
    ShowEditProfileButton();
    HidePreferencesProfile();
    HideSettingsStaticPage('#pageResources');
    HideSettingsStaticPage('#pageTerms');
    HideSettingsStaticPage('#pageHelp');
    HideSettingsStaticPage('#pageStartOver');
    HideSettingsStaticPage('#pageOptOut');
    HideSettingsStaticPage('#pageDeleteAccount');
    CloseTrouble();
    CloseDisclaimer();
    ResetOverlayEvent();
};

function ResetOverlayEvent() {
    $('#settingsOverlay-close').off();
    $('#settingsOverlay-close').on('click', function () {
        HideSettingsMenu();
        HideSettingsProfile();
        HideSocialProfile();
        ShowEditProfileButton();
        HidePreferencesProfile();
        HideSettingsStaticPage('#pageResources');
        HideSettingsStaticPage('#pageTerms');
        HideSettingsStaticPage('#pageHelp');
        HideSettingsStaticPage('#pageStartOver');
        HideSettingsStaticPage('#pageOptOut');
        HideSettingsStaticPage('#pageDeleteAccount');
        CloseTrouble();
        CloseDisclaimer();
  });
}

function ActionCancel() {
 //   $('#hdnActionID').val('');
}

function DeleteConfirm() {
    Deletephoto();
}

function Deletephoto() {

    ShowLoader();

    $.ajax({
        type: "POST",
        url: config.Path + '/user/deletephoto',
        data: _user
    }).done(function (data) {
        //alert(JSON.stringify(data));
        if (data === null) {
            HandleError("user/saveuser returned null");
            return;
        }
        _user = data;
        _user.SocialImagePath = "";
        _dataForImage = "";
        _user.SocialImageData = "";
        LoadSocialProfile();
        HideSocialProfile();
        ShowSuccess("Profile photo Deleted.");
        $('#smallImage').css('background-image', 'url(img/social-icon.png)');
        HideLoader();
    });
  
}

function LoadSocialProfile(){
    var publicName = _user.PublicName;
    var aboutMe = _user.AboutMe;
    var imagePath = _user.SocialImagePath;
    var hasKids = _user.HasKids;
	var isSingle = _user.IsSingle;
	var isEmptyNester = _user.IsEmptyNester;
    var isAvailable = _user.IsAvailable;
    var timeZoneSetting = _user.TimeZone;
	var employed = _user.SocialEmployment;
    var dob = moment(_user.DateOfBirth).format('MM/DD/YYYY');

    //console.log(JSON.stringify(_user));

   
    //$('#screenName').val(publicName);
    $('#screenName').val(_user.FirstName);
    $('#dateOfBirth').val(dob);
    $('#timeZone').val(timeZoneSetting);
    $('#aboutMeText').val(aboutMe);

    $('#socialAvailable').prop('checked', isAvailable);
	$('#stagesKids').prop('checked', hasKids);
	$('#stagesEmpty').prop('checked', isEmptyNester);
	$('#stagesSingle').prop('checked', isSingle);

	if (employed !== null)
		$('#employmentStatus').val(employed);

    if (imagePath !== null){
    	$('#smallImage').css('background-image', 'url(' + config.AWS + imagePath + ')');
    	$('#smallImage').css('display', 'block');
    }
	else {
		$('#smallImage').css('background-image', 'url(img/social-icon.png)');
    	$('#smallImage').css('display', 'block');
	}

}


// Called when a photo is successfully retrieved
//
function takePhotoSuccess(imageData) {
	_dataForImage = imageData;

	// Show the captured photo
	$('#smallImage').css('background-image', 'url(data:image/jpeg;base64,' + imageData + ')');
}

function capturePhotoWithData() {
  // Take picture using device camera and retrieve image as base64-encoded string
  navigator.camera.getPicture(takePhotoSuccess, onFail, { quality: 40, destinationType: Camera.DestinationType.DATA_URL, targetWidth: 200, targetHeight: 200, encodingType: Camera.EncodingType.JPEG });
}
  //called to get photo from phone library
function getPhoto(source) {
  // Retrieve image file location from specified source
  navigator.camera.getPicture(takePhotoSuccess, onFail, { quality: 40,
  destinationType: Camera.DestinationType.DATA_URL,
  sourceType: source, targetWidth: 200, targetHeight: 200 });

}

// Called if something bad happens.
//
function onFail(message) {
	HandleError(message);
}

function SaveSocialProfile(){

	var available = $('#socialAvailable').prop('checked');
	var hasKids = $('#stagesKids').prop('checked');
	var isSingle = $('#stagesSingle').prop('checked');
	var isEmptyNester = $('#stagesEmpty').prop('checked');
	var timeZone = $('#timeZone').val();
	var dob = $('#dateOfBirth').val();
	var aboutMe = $('#aboutMeText').val();
	var publicName = $('#screenName').val();
	var employment = $('#employmentStatus').val();

	if (publicName === '') {
		ShowError('Please enter the your public name.');
		return;
	}

	if (!moment(dob).isValid()){
		ShowError("Please enter a valid birthday.");
		return;
	}

	_user.PublicName = publicName;
	_user.AboutMe = aboutMe;
    ///_user.SocialImageData = _dataForImage;
	if (_dataForImage !== "")
	    _user.SocialImageData = _dataForImage;
	else
	    _user.SocialImageData = _user.SocialImageData;

    _user.IsAvailable = available;
	_user.HasKids = hasKids;
	_user.IsEmptyNester = isEmptyNester;
	_user.IsSingle = isSingle;
	_user.TimeZone = timeZone;
	_user.DateOfBirth = dob;
	_user.SocialEmployment = employment;
	ShowLoader();
	$.ajax({
		type: "POST",
		url: config.Path + '/user/saveuser',
		data: _user
	}).done(function(data){
		//alert(JSON.stringify(data));
		if (data === null){
			HandleError("user/saveuser returned null");
			return;
		}
		_user = data;

		LoadSocialProfile();
		
		ShowSuccess("Social Profile Saved.");
		HideLoader();
	});
	HideSocialProfile();
}


