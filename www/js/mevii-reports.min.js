
function InitializeReports(){
	GetReports();

	$('#reportsPrev').on('click', function(){
		MovePageRight('#pageReports', _currentPage);
	});

	$('#reportShowPrev').on('click', function(){
		MovePageRight('#pageReportsList', _currentPage);
	});
}

function GetReports(){
	$.ajax({
        type: "GET",
        url: config.Path + '/report/get',
        data: { UserID: _user.ID }
    }).done(function(data){

    	var returnedData = data;

    	// alert(JSON.stringify(data));
    	if(data === null){
    		$('#reportsList').html("No reports are available to show you.");
    		HideLoader();
    		HandleError("Reports GET call returned null...");
			return;
    	}
    	
		var i = 0;
		var length = data.length;
		var reportTypes = [];

		for(i=0; i<length; i++){
			var value = data[i].Type;
			if(reportTypes.indexOf(value) == -1){
				reportTypes.push(value);
			}
		}

		var x = 0;
		var typesLength = reportTypes.length;
		var html = "";

		for (x=0; x < typesLength; x++){
			if(reportTypes[x].toLowerCase().indexOf("long") == -1){
				var rt = reportTypes[x];

				// make it user friendly
				if (rt.indexOf('eom') >= 0){ // End of Level
					var lvl = parseInt(rt.substr(rt.indexOf(' ')).trim());
					//lvl++;
					rt = "Check Your Progress - Level " + lvl;
				}
				else if (rt.indexOf('motivation')) {
					rt = 'Motivation - Summary';
				}
				else if (rt.indexOf('discovery')) {
					rt = 'Discovery - Summary';
				}

				html += '<div class="reportList row pageRow" id="' + reportTypes[x] + '">';
				html += '<div class="col-xs-2"><img src="img/assets/iconReports.png" /></div>';
				html += '<div class="col-xs-8">' + rt + '</div>';
				html += '<div class="col-xs-2"><i class="fa fa-arrow-right"></i></div></div>';
			}
		}

		$('#reportsList').html(html);

		$('.reportsList').off();
		$('.reportList').on('click', function(){
			MovePageLeft('#pageReportsList', _currentPage);
			var rt = $(this).attr('id');
			var header = ''
			if (rt.indexOf('eom') >= 0){ // End of Level
				var lvl = parseInt(rt.substr(rt.indexOf(' ')).trim());
				//lvl++;
				header = "Level " + lvl + " Progress Reports";
			}
			else if (rt.indexOf('motivation')) {
				header = 'Motivation Summaries';
			}
			else if (rt.indexOf('discovery')) {
				header = 'Discovery Summaries';
			}

			$('.reportHeader').html(header);
			ListSelectedReports(rt, returnedData);
		});

    }); // end .done
}

function ListSelectedReports(type, data){
	var selectedType = type;
	var reportData = data;
	// alert(JSON.stringify(reportData));

	var i = 0;
	var length = reportData.length;
	var html = "";

	var offset = new Date().getTimezoneOffset();

	for(i=0; i<length; i++){
		if(reportData[i]["Type"] == selectedType){

			var d = reportData[i]["UpdateTime"];

			var date = moment(d).subtract(offset, 'minutes').format('MMMM Do, YYYY h:mm a');
			html += '<div class="showReports row pageRow" id="' + reportData[i]["ID"] + '"><div class="col-xs-10">' + date + '</div><div class="col-xs-2"><i class="fa fa-arrow-right"></i></div></div>';
		}
	}

	$('#showReports').html(html);

	$('.showReports').off();
	$('.showReports').on('click', function(){
		MovePageLeft('#pageReportsShow', _currentPage);
		var selectedReport = $(this).attr('id');
		ShowSelectedReport(selectedReport, reportData);
	});
}

function ShowSelectedReport(report, data){
	var selectedReport = report; // the selected report's ID
	var reportData = data;
	var html = "";

	var i = 0;
	var length = reportData.length;
	for(i=0; i<length; i++){
		if(selectedReport==reportData[i]["ID"]){
			html = Encoder.htmlDecode(reportData[i]["Html"]);
			// alert(html);
			break;
		} else {
			html = '<div>We could not find that report.</div>';
		}
	}

	$('#reportShow').html(html);
}

