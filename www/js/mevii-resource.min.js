// ********************************
// Javascript for the Support Resources Tool
// ********************************

var _returnedMeviiResources;

var _meviiResourceSelections = {};
var _meviiResourceURL = "";

var _supportType = null;
var _supportText = null;

function InitializeResources(){

	$('#resourcesToolBtn').on('click', function(){
		GetMeviiResources();
		GetSupportResourceText();
		ShowyClose('#pageResourcesTool');
	});

	$('.resource1').on('click', function(){
		var supportType = $(this).parent().attr('id');
		_supportType = supportType;
		_supportText = ConvertParentIDtoString();

		SetMeviiResourcesButtons();
		GetMeviiResourceType();
		MovePageLeft('#pageMeviiResource', _currentPage);
	});

	$('.resource2').on('click', function(){ //Btn for Support Resources (text box)
		// if($(this).hasClass('opacity50')){
		_supportType = $(this).parent().attr('id');
		_supportText = ConvertParentIDtoString();
		GetSupportResourceText();
		// FillResourceTextBox();
		MovePageLeft('#pageResourceSupport', _currentPage);
	});

	$('.resourceBtn').on('click', function(){
		if($(this).hasClass('opacity50')){
			$(this).removeClass('opacity50');
		} else {
			$(this).addClass('opacity50');
		}
	});

	$('#meviiResourcesBtn').on('click', function(){ //Done/Save btn for Mevii Resources
		SetMeviiResourcesObject();
		GatherMeviiResources();
		// GetSupportResourceText();
		// GetMeviiResources();
		// SetMeviiResourcesButtons();
	});

	$('#calendarResourcesBtn').on('click', function(){
		MovePageRight('#pageResourcesTool', _currentPage);
	});

	$('#supportResourcesBtn').on('click', function(){
		SaveSupportResources();
		GetSupportResourceText();
		// $('#supportResourcesText').val("");
		// GetSupportResourceText();
		// FillResourceTextBox();
	});
	
	$('#pageSupportResourceClose').on('click', function(){
		if (_isEmbeddedResources){
			_isEmbeddedResources = false;
			ShowNextPage(); // in contentengine...
		}
		else
			ShowHomePage();
	})
}

function ConvertParentIDtoString(){
	switch(_supportType){
		case 'pleasantRT':
			return "PleasantActivity";
		case 'exercisingRT':
			return "Exercise";
		case 'eatingRT':
			return "HealthyEating";
		case 'sleepingRT':
			return "Sleeping";
		case 'socialRT':
			return "SocialActivity";
		case 'relaxingRT':
			return "Relaxing";
		case 'communicatingRT':
			return "Communicating";
	}
}

function FillResourceTextBox(support){
	var parent = ConvertParentIDtoString(_supportResourceParent);

	for(var x = 0; x < support.length; x++){
		var s = support[x];

		if(s.Type == parent){
			$('#supportResourcesText').text(s.Text);
			break;
		} else {
			$('#supportResourcesText').text("");
		}
	}
}

function MatchMeviiResourceID(id){
	switch(id){
		case 'resource1':
			return 'GoalSettingTool';
		case 'resource2':
			return 'JournalTool';
		case 'resource3':
			return 'SetReminders';
		case 'resource4':
			return 'TipSheets';
		case 'resource5':
			return 'Relaxation';
		case 'resource6':
			return 'SchedulePleasantActivity';
		case 'resource7':
			return 'Eating';
		case 'resource8':
			return 'Sleeping';
		case 'resource9':
			return 'Exercising';
		case 'resource10':
			return 'CommunicationHelpTeam';
		case 'resource11':
			return 'CommunicationFamily';
		case 'resource12':
			return 'AssertivenessTool';
	}
}

function GatherMeviiResources(){
	$('#meviiResourceGroup').children('div').each(function(){ // Loop through all Mevii Resource btns
		var id = $(this).attr('id'); // id is the ID of the btn
		if(!$(this).hasClass('opacity50')){ // if the btn is selected
			var matchedID = MatchMeviiResourceID(id); //match the id with column name in DB e.g. 'PleasantActivity'
			_meviiResourceSelections[matchedID] = true; //make the column name in object 'true', e.g. 'PleasantActivity:true'
			 //alert(JSON.stringify(_meviiResourceSelections));
			// $(this).addClass('opacity50'); // resetting btn to opacity50
		}
	});
	 //alert(JSON.stringify(_meviiResourceSelections));
	$.ajax({
		url: config.Path + _meviiResourceURL,
		data: JSON.stringify(_meviiResourceSelections),
		contentType: 'application/json; charset=utf-8',
		type: "POST"
	}).done(function(data){
		// alert(JSON.stringify(data));
		MovePageRight('#pageResourcesTool', _currentPage);
		ResetMeviiResourceBtns();
		GetMeviiResources();
		ShowSuccess("Mevii Resource saved");

	});
}

function GetMeviiResources(){
	$.ajax({
        type: "GET",
        url: config.Path + '/support/getresources',
        data: { userID: _user.ID }
    }).done(function(data){
    	_returnedMeviiResources = data;
    	// alert(JSON.stringify(_returnedMeviiResources));
    	SetResourceFolderStatus(data);
    });
}

function GetMeviiResourceType(){
	switch(_supportType){
		case 'pleasantRT':
			MeviiPleasantActivityLoop();
			break;
		case 'exercisingRT':
			MeviiExerciseLoop();
			break;
		case 'eatingRT':
			MeviiEatingLoop();
			break;
		case 'sleepingRT':
			MeviiSleepingLoop();
			break;
		case 'socialRT':
			MeviiSocialLoop();
			break;
		case 'relaxingRT':
			MeviiRelaxingLoop();
			break;
		case 'communicatingRT':
			MeviiCommunicatingLoop();
			break;
	}
}

function GetSupportResourceText(){
	$.ajax({
        type: "GET",
        url: config.Path + '/support/gettext',
        data: { userID: _user.ID }
    }).done(function(data){
    	SetSupportResourceFolders(data);
    	FillResourceTextBox(data);
    });
}

// ****** THE FOLLOWING 7 LOOPS REMOVE OPACITY OF BTNS FOR SELECTED RESOURCE ***********

function MeviiCommunicatingLoop(){
	var object = MeviiObjectForButtons("Communicating");
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["CommunicationHelpTeam"]===true){
		$('#resource10').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
	if(object["CommunicationFamily"]===true){
		$('#resource11').removeClass('opacity50');
	}
	if(object["AssertivenessTool"]===true){
		$('#resource12').removeClass('opacity50');
	}
//"Type":"Communicating","GoalSettingTool":true,"JournalTool":false,"SetReminders":true,"TipSheets":false,
//"CommunicationHelpTeam":true,"CommunicationFamily":true
}

function MeviiExerciseLoop(){
	var object = MeviiObjectForButtons("Exercise");
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["Exercising"]===true){
		$('#resource9').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
//,"Type":"Exercise","GoalSettingTool":true,"JournalTool":false,"SetReminders":false,"TipSheets":false,"Exercising":false,
}

function MeviiEatingLoop(){
	var object = MeviiObjectForButtons();
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["Eating"]===true){
		$('#resource7').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
//"Type":"HealthyEating","GoalSettingTool":false,"JournalTool":true,"SetReminders":true,"TipSheets":false,"Eating":true,
}

function MeviiObjectForButtons(type){
	var x = 0;
	for(x = 0; x < _returnedMeviiResources.length; x++){
		var r = _returnedMeviiResources[x];

		if(r.Type == _supportText)
			return r;
	}
}

function MeviiPleasantActivityLoop(){
	var object = MeviiObjectForButtons("PleasantActivity");
	// alert(object["GoalSettingTool"]);
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["SchedulePleasantActivity"]===true){
		$('#resource6').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
	// alert(JSON.stringify(object));
	// alert(object["JournalTool"]);
}

function MeviiRelaxingLoop(){
	var object = MeviiObjectForButtons("Relaxing");
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["Relaxation"]===true){
		$('#resource5').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
//"Type":"Relaxing","GoalSettingTool":true,"JournalTool":false,"SetReminders":true,"TipSheets":false,"Relaxation":true,"
}

function MeviiSleepingLoop(){
	var object = MeviiObjectForButtons("Sleeping");
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["TipSheets"]===true){
		$('#resource4').removeClass('opacity50');
	}
	if(object["Sleeping"]===true){
		$('#resource8').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
//"Type":"Sleeping","GoalSettingTool":false,"JournalTool":true,"SetReminders":false,"TipSheets":false,"Sleeping":true,
}

function MeviiSocialLoop(){
	var object = MeviiObjectForButtons("SocialActivity");
	// alert(JSON.stringify(object));
	if(object == undefined){
		return;
	}
	if(object["GoalSettingTool"]===true){
		$('#resource1').removeClass('opacity50');
	}
	if(object["JournalTool"]===true){
		$('#resource2').removeClass('opacity50');
	}
	if(object["SetReminders"]===true){
		$('#resource3').removeClass('opacity50');
	}
	if(object["SchedulePleasantActivity"]===true){
		$('#resource6').removeClass('opacity50');
	}
//"Type":"SocialActivity","GoalSettingTool":true,"JournalTool":false,"SetReminders":true,
}

function ResetMeviiResourceBtns(){
	$('#meviiResourceGroup').children('div').each(function(){ // Loop through all Mevii Resource btns
		if(!$(this).hasClass('displayNone')){
			$(this).addClass('displayNone');
		}
	});
	$('#meviiResourceGroup').children('div').each(function(){ // Loop through all Mevii Resource btns
		if(!$(this).hasClass('opacity50')){
			$(this).addClass('opacity50');
		}
	});
}

function ResetSupportResourceFolders(){
	$('#pageResourcesTool').children('img').each(function(){
        if(!$(this).hasClass('opacity50')){
            $(this).addClass('opacity50');
        }
    });
}

function SaveSupportResources(){
	var text = $('#supportResourcesText').val();
	var type = ConvertParentIDtoString();
    var supportResourceData = { userID: _user.ID, Type: type, Text: text };

	$.ajax({
		type: 'POST',
		url: config.Path + '/support/savetext',
		data: supportResourceData
	}).done(function(data){
		MovePageRight('#pageResourcesTool', _currentPage);
		ShowSuccess("Support Resource saved");
	});
}
//changes opacity of the first icon on first page
function SetResourceFolderStatus(resources){
	var x = 0;

	for(x=0; x < resources.length; x++){
		var r = resources[x];

		switch(r.Type){
			case 'PleasantActivity':
				$('#pleasantRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'Exercise':
				$('#exercisingRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'HealthyEating':
				$('#eatingRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'Sleeping':
				$('#sleepingRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'SocialActivity':
				$('#socialRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'Relaxing':
				$('#relaxingRT .resource1 img').removeClass('nonfunctional');
				break;
			case 'Communicating':
				$('#communicatingRT .resource1 img').removeClass('nonfunctional');
				break;
		}
	}
}
//changes opacity of the second icon on first page
function SetSupportResourceFolders(support){
	ResetSupportResourceFolders();
	var x = 0;
	for(x=0; x < support.length; x++){
		var s = support[x]
		switch(s.Type){
			case 'PleasantActivity':
				if(s.Text !== null){
					$('#pleasantRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'Exercise':
				if(s.Text !== null){
					$('#exercisingRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'HealthyEating':
				if(s.Text !== null){
					$('#eatingRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'Sleeping':
				if(s.Text !== null){
					$('#sleepingRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'SocialActivity':
				if(s.Text !== null){
					$('#socialRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'Relaxing':
				if(s.Text !== null){
					$('#relaxingRT .resource2 img').removeClass('nonfunctional');
				}
				break;
			case 'Communicating':
				if(s.Text !== null){
					$('#communicatingRT .resource2 img').removeClass('nonfunctional');
				}
				break;
		}
	}
}

function SetMeviiResourcesButtons(){
	switch(_supportType){
		case 'pleasantRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource6').removeClass('displayNone');
			break;
		case 'exercisingRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource9').removeClass('displayNone');
			break;
		case 'eatingRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource7').removeClass('displayNone');
			break;
		case 'sleepingRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource8').removeClass('displayNone');
			break;
		case 'socialRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource6').removeClass('displayNone');
			break;
		case 'relaxingRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource5').removeClass('displayNone');
			break;
		case 'communicatingRT':
			$('#resource1').removeClass('displayNone');
			$('#resource2').removeClass('displayNone');
			$('#resource3').removeClass('displayNone');
			$('#resource4').removeClass('displayNone');
			$('#resource10').removeClass('displayNone');
			$('#resource11').removeClass('displayNone');
			$('#resource12').removeClass('displayNone');
			break;
	}
}

function SetMeviiResourcesObject(){
	switch(_supportType){
		case 'pleasantRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, TipSheets: false, SchedulePleasantActivity: false, SetReminders: false };
			_meviiResourceURL = '/support/savePleasantActivityresource';
			break;
		case 'exercisingRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false, TipSheets: false, Exercising: false };
			_meviiResourceURL = '/support/saveExerciseresource';
			break;
		case 'eatingRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false, TipSheets: false, Eating: false };
			_meviiResourceURL = '/support/saveHealthyEatingresource';
			break;
		case 'sleepingRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false, TipSheets: false, Sleeping: false };
			_meviiResourceURL = '/support/saveSleepingresource';
			break;
		case 'socialRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false };
			_meviiResourceURL = '/support/saveSocialActivityresource';
			break;
		case 'relaxingRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false, TipSheets: false, Relaxation: false };
			_meviiResourceURL = '/support/saveRelaxingresource';
			break;
		case 'communicatingRT':
			_meviiResourceSelections = { userID: _user.ID, GoalSettingTool: false, JournalTool: false, SetReminders: false, TipSheets: false, CommunicationHelpTeam: false, CommunicationFamily: false };
			_meviiResourceURL = '/support/saveCommunicatingresource';
			break;
	}
}

